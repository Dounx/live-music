import React from 'react'
import MusicApi from './music-api'
import Spinner from './spinner'

<% include Rails.application.routes.url_helpers %>

class Item extends React.Component {
    constructor(props) {
        super(props)

        this.state = {
            id: props.id,
            cover: props.cover,
            name: props.name,
            url: `<%= url_for(rooms_path) %>/${props.id}`
        }
    }

    handleClick(event) {
        const href = $(event.currentTarget).data('href')
        window.location = href
    }

    render() {
        const { url, cover, name } = this.state

        return (
            <div
                className="card"
                data-clickable="true"
                data-href={url}
                onClick={this.handleClick}
                style={{cursor: 'pointer'}}
            >

                <img className="card-img-top"
                     src={cover}
                     alt="Card image cap"
                />
                <div className="card-body">
                    <h5 className="card-title">{name}</h5>
                </div>
            </div>
        )
    }
}

export default class Playlist extends React.Component {
    constructor(props) {
        super(props)

        this.state = {
            id: props.id,
            cookie: props.cookie,
            api: new MusicApi(props.id, props.cookie),
            playlists: [],
            isLoading: true
        }
    }

    async componentDidMount() {
        const { id, api } = this.state
        const data = await api.getPlaylists(id)
        this.setState({
            playlists: data.playlist,
            isLoading: false
        })
    }

    render() {
        const playlists = this.state.playlists.map((playlist) =>
            <Item
                key={playlist.id}
                id={playlist.id}
                name={playlist.name}
                cover={playlist.coverImgUrl}
            />
        )

        return (
            <div>
                { this.state.isLoading ? <Spinner /> : null }
                <div className="card-deck">
                    {playlists}
                </div>
            </div>
        )
    }
}

